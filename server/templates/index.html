<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart School Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background-color: #f0f2f5; font-family: 'Segoe UI', sans-serif; }
        .dashboard-header { text-align: center; margin: 30px 0; color: #1a1a1a; font-weight: 700; }
        
        .class-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            transition: transform 0.2s;
        }
        .class-card:hover { transform: translateY(-5px); }

        .status-row { display: flex; justify-content: space-between; margin: 20px 0; text-align: center; }
        .data-val { font-size: 1.2rem; font-weight: bold; display: block; }
        .data-label { font-size: 0.8rem; color: #888; }
        
        /* Custom Button Styles from Screenshot */
        .btn-custom-on {
            background-color: #e8f5e9; color: #2e7d32; border: none; font-weight: 600; width: 48%; padding: 10px;
        }
        .btn-custom-on:hover { background-color: #c8e6c9; color: #1b5e20; }
        .btn-custom-on.active { background-color: #4caf50; color: white; }

        .btn-custom-off {
            background-color: #ffebee; color: #c62828; border: none; font-weight: 600; width: 48%; padding: 10px;
        }
        .btn-custom-off:hover { background-color: #ffcdd2; color: #b71c1c; }
        .btn-custom-off.active { background-color: #ef5350; color: white; }

        .btn-auto {
            width: 100%; margin-top: 10px; background-color: #e3f2fd; color: #1565c0; border: none; font-weight: 600;
        }
        .btn-auto:hover { background-color: #bbdefb; }

        .mode-badge {
            float: right; font-size: 0.8rem; padding: 5px 10px; border-radius: 20px;
        }
        .mode-auto { background-color: #e3f2fd; color: #1976d2; }
        .mode-manual { background-color: #eeeeee; color: #616161; }
        
        .online-dot { height: 12px; width: 12px; background-color: #bbb; border-radius: 50%; display: inline-block; margin-right: 5px; }
        .online-dot.active { background-color: #4caf50; }
    </style>
</head>
<body>

<div class="container">
    <h2 class="dashboard-header">Smart School Dashboard</h2>
    
    <div class="row" id="cards-container">
        </div>
</div>

<script>
    async function updateDashboard() {
        try {
            const response = await fetch('/api/status');
            const data = await response.json();
            const container = document.getElementById('cards-container');
            container.innerHTML = '';

            data.forEach(room => {
                const isAuto = room.mode === 'AUTO';
                const lightOn = room.light_status === 'ON';
                
                // HTML Template for one card
                const cardHtml = `
                <div class="col-md-4">
                    <div class="class-card">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 style="font-weight: 700;">
                                <span class="online-dot active"></span> ${room.classroom_id}
                            </h5>
                            <span class="mode-badge ${isAuto ? 'mode-auto' : 'mode-manual'}">
                                ${isAuto ? 'AUTO (AI)' : 'MANUAL'}
                            </span>
                        </div>

                        <div class="status-row">
                            <div>
                                <span class="data-val">${room.last_temp}Â°C</span>
                                <span class="data-label">Temp</span>
                            </div>
                            <div>
                                <span class="data-val">${room.last_lux}</span>
                                <span class="data-label">Lux</span>
                            </div>
                            <div>
                                <span class="data-val">${room.last_motion ? 'Yes' : 'No'}</span>
                                <span class="data-label">Motion</span>
                            </div>
                        </div>

                        <div class="d-flex justify-content-between">
                            <button onclick="control('${room.classroom_id}', 'ON')" 
                                class="btn btn-custom-on ${!isAuto && lightOn ? 'active' : ''}">LIGHT ON</button>
                            <button onclick="control('${room.classroom_id}', 'OFF')" 
                                class="btn btn-custom-off ${!isAuto && !lightOn ? 'active' : ''}">LIGHT OFF</button>
                        </div>
                        <button onclick="control('${room.classroom_id}', 'AUTO')" class="btn btn-auto">
                            <i class="fas fa-sync-alt"></i> RESET TO AUTO
                        </button>
                    </div>
                </div>`;
                
                container.innerHTML += cardHtml;
            });
        } catch (e) { console.error(e); }
    }

    async function control(id, action) {
        await fetch('/api/control', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({classroom_id: id, action: action})
        });
        updateDashboard(); // Refresh immediately
    }

    setInterval(updateDashboard, 2000);
    updateDashboard();
</script>
</body>
</html>
